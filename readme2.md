## Implementační dokumentace k 2. úloze do IPP 2021/2022  
Jméno a příjmení: Lucie Svobodová  
Login: xsvobo1x  

### Úvod  
Cílem druhého úkolu bylo naprogramovat skripty `interpret.py` v jazyce Python3.8 a `test.php` v jazyce PHP8.1. Skript `interpret.py` provádí interpretaci XML reprezentace kódu napsaného v jazyce IPPcode22. V rámci tohoto skriptu bylo implementováno rozšíření `STACK` a `NVI`. Skript `test.php` je testovacím rámcem sloužícím pro testování skriptů `parse.php` (viz úloha č. 1) a `interpret.py`. Generuje přehledovou stránku v HTML5 o úspěšnosti/neúspěšnosti jednotlivých testů.

### Interpret XML reprezentace kódu (`interpret.py`)  
Při implementaci interpretu bylo aplikováno objektově orientované programování (rozšíření `NVI`). V hlavním těle programu jsou nejdříve zkontrolovány  zadané argumenty příkazové řádky, případně zadané argumenty `--input` a `--source` jsou následně předány jako argumenty potřebným funkcím. Dále je vytvořena instance třídy `Program`, která byla implementována podle návrhového vzoru Jedináček. Tato instance je tedy jediná v celém programu a uchovává informace potřebné pro interpretaci vstupního souboru - rámce, slovník a čítač instrukcí, zásobník volání a slovník definovaných návěští. Vytvořena je také instance třídy `Stack`, která je opět navržena podle návrhového vzoru Jedináček a představuje datový zásobník. Následně je zavolána funkce `interpret()`, ve které je načten a analyzován vstupní XML soubor, přičemž je kontrolována jeho struktura a v případě chyby vrácen odpovídající návratový kód. Je zkontrolována jak přítomnost všech povinných elementů a jejich atributů, tak i nepřítomnost elementů a atributů nepovolených. Dále jsou vytvářeny instance tříd reprezentujících jednotlivé instrukce, k čemuž je využita třída `Factory`, která byla implementována podle návrhového vzoru Tovární metoda. Její metoda `resolve()` podle názvu operačního kódu volá konstruktory tříd reprezentujících jednotlivé instrukce. Vytvořené instance jsou zařazeny do slovníku instrukcí.  

Pro reprezentaci instrukcí byla využita třída `Instruction`, ze které jsou odvozeny třídy reprezentující konkrétní instrukce (například třídy `Createframe`, `Move`). Od třídy `Instruction` je také odvozena třída `Arithmetic`, která je využita pro instrukce realizující aritmetické operace a ze které jsou odvozeny další třídy  (například `Add`, `Sub`). Po skončení funkce `xml_parse()` jsou ve slovníku instrukcí uloženy všechny instrukce, které budou interpretovány. Tyto instrukce jsou seřazeny podle svého pořadí (daného atributem `order`) a následně v cyklu interpretovány. Každá třída reprezentující konkrétní instrukci má definovanou metodu `execute()`, která interpretaci specifickou pro danou instrukci provádí. Tok programu může být po použití některé z instrukcí skoku nebo podmíněných skoků upraven, což je realizováno nastavením čítače instrukcí pomocí metody `prog.set_instr_counter()`. Po skončení tohoto cyklu (případně po ukončení programu instrukcí IPPcode22 `EXIT`) končí celý program. Pokud v průběhu interpretace dojde k chybě, je o ní vypsána informace na standardní chybový výstup a program je okamžitě ukončen s odpovídajícím návratovým kódem.  

Ve skriptu `interpret.py` je také implementováno rozšíření `STACK`, které přidává možnost použití instrukcí pracujících s datovým zásobníkem. Byly implementovány všechny instrukce uvedené v popisu tohoto rozšíření. Instrukce `JUMPIFEQS` a `JUMPIFNEQS` vyžadují jeden operand, který specifikuje návěští, na které se má v případě splnění podmínek skočit. Ostatní instrukce pracují pouze s datovým zásobníkem, ze kterého vybírají potřebný počet operandů a výsledek ukládají zpět na datový zásobník.  

### Testovací rámec (`test.php`)  

Testovací rámec je implementován v souboru `test.php`. V hlavním těle programu jsou nejdříve načteny argumenty příkazové řádky a je zkontrolováno, zda jsou validní. Pokud některý z argumentů není zadán, je použita implicitní hodnota specifikovaná v zadání. Následně je vygenerována základní struktura HTML5 stránky. Pro generování stránky je využita knihovna `DOM`. Dále je rozhodnuto, zda má být spuštěno rekurzivní či nerekurzivní prohledávání adresářů a podle toho je zavolána odpovídající funkce. Pro rekurzivní prohledávání adresářů jsou využity iterátory.  

Skript prochází všechny zadané soubory, příp. i adresáře, a pro každý soubor s příponou `.src` nejdříve zavolá funkci `test_setup()`. Ta vygeneruje chybějící soubory `.in`, `.out` a `.rc`. Následně je zavolána funkce `test_exercise_verify()`, která spouští odpovídající skripty (`parse.php` a `interpret.py`, příp. pouze jeden z nich, pokud jsou zadány argumenty `--int-only` nebo `--parse-only`). Výsledné návratové kódy, resp. výstupy těchto skriptů jsou porovnávány s očekávanými návratovými kódy, resp. očekávanými výstupy (pro `parse.php` pomocí nástroje `JexamXML` a pro `interpret.py` pomocí nástroje `diff`). Po provedení testu je výsledek testu přidán jako element do postupně generované HTML5 stránky. Po dokončení testování všech vstupních souborů je do HTML5 stránky vložena informace o celkovém výsledku testování (počet úspěšných/neúspěšných testů a celkový počet testů). Výsledná HTML5 stránka je následně vypsána na standardní výstup.
